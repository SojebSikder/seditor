(function(r,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(r=typeof globalThis<"u"?globalThis:r||self,c(r.Soditor={}))})(this,function(r){"use strict";var T=Object.defineProperty;var M=(r,c,g)=>c in r?T(r,c,{enumerable:!0,configurable:!0,writable:!0,value:g}):r[c]=g;var d=(r,c,g)=>M(r,typeof c!="symbol"?c+"":c,g);class c{constructor(){d(this,"listeners",{})}on(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}off(t,e){var n;this.listeners[t]=(n=this.listeners[t])==null?void 0:n.filter(o=>o!==e)}emit(t,e){var n;(n=this.listeners[t])==null||n.forEach(o=>o(e))}}const g={};function v(i,t){g[i]=t}function p(){return g}class E{constructor(t){d(this,"editor");this.editor=t}addTooltip(t,e){t.classList.add("soditor-tooltip");const n=document.createElement("div");n.classList.add("soditor-tooltiptext"),n.innerHTML=e||"",t.appendChild(n)}addButton(t,e){const n=document.createElement("button");n.name=t,n.innerHTML=e.text||"",this.addTooltip(n,e.tooltip||""),n.setAttribute("aria-label",e.tooltip||""),n.classList.add("soditor-btn"),n.onclick=()=>{e.onAction&&(e.onAction(),this.editor.saveState())},this.editor.toolbar.appendChild(n)}addDropdown(t,e){const n=document.createElement("div");n.classList.add("soditor-dropdown");const o=document.createElement("button");o.innerHTML=e.text||t,o.setAttribute("aria-label",e.tooltip||""),o.classList.add("soditor-btn"),this.addTooltip(o,e.tooltip||"");const l=document.createElement("div");l.classList.add("soditor-dropdown-content");for(const s of e.options||[]){const a=document.createElement("a");a.textContent=s.label,a.onclick=()=>{s.onSelect&&(this.editor.restoreSelection(),s.onSelect(s.value),this.editor.saveSelection())},l.appendChild(a)}o.onclick=()=>{this.editor.saveSelection(),l.classList.toggle("soditor-show")},window.onclick=s=>{if(!s.target.matches(".soditor-btn")){const a=document.getElementsByClassName("soditor-dropdown-content");for(let u=0;u<a.length;u++)a[u].classList.contains("soditor-show")&&a[u].classList.remove("soditor-show")}},n.appendChild(o),n.appendChild(l),this.editor.toolbar.appendChild(n)}addModal({id:t,title:e,content:n,buttons:o}){var u,m,f;const l=document.createElement("div");l.id=t,l.classList.add("soditor-modal"),l.innerHTML=`
    <div class="soditor-modal-content">
      <span class="soditor-close">&times;</span>
      <h2 class="soditor-modal-title">${e}</h2>
      <div class="soditor-modal-body">${n}</div>
      <div class="soditor-modal-footer">
      ${o?o.map(h=>`<button class="soditor-btn ${h.primary?"soditor-btn-primary":""}">${h.text}</button>`).join(""):""}
      </div>
    </div>
  `,document.body.appendChild(l);const s=()=>{l.style.display="none"};(u=l.querySelector(".soditor-close"))==null||u.addEventListener("click",s),(m=l.querySelector(".soditor-modal-cancel"))==null||m.addEventListener("click",s),(f=l.querySelector(".soditor-modal-confirm"))==null||f.addEventListener("click",()=>{s()}),l.querySelectorAll(".soditor-modal-footer button").forEach((h,S)=>{o&&o[S]&&h.addEventListener("click",()=>{const R={closeModal:()=>s()};o[S].onClick(R)})}),window.addEventListener("click",h=>{h.target===l&&s()}),window.addEventListener("keydown",h=>{h.key==="Escape"&&s()})}showModal(t){const e=document.getElementById(t);e&&(e.style.display="block")}closeModal(t){const e=document.getElementById(t);e&&(e.style.display="none")}}function b(i,t){let e=null;return function(...n){e!==null&&clearTimeout(e),e=window.setTimeout(()=>i.apply(this,n),t)}}class y{constructor(t,e){d(this,"toolbar");d(this,"editor");d(this,"plugins",[]);d(this,"ui");d(this,"maxHistory",100);d(this,"undoStack",[]);d(this,"redoStack",[]);d(this,"savedRange",null);d(this,"inputListener");d(this,"emitter",new c);const n=document.querySelector(t),o=document.querySelector(e);if(!n||!o)throw new Error("Toolbar or Editor not found");this.toolbar=n,this.editor=o,this.toolbar.setAttribute("role","toolbar"),this.editor.setAttribute("role","textbox"),this.editor.setAttribute("contenteditable","true");const l=b(()=>{this.saveState(),this.emitter.emit("input",{html:this.editor.innerHTML})},300);this.inputListener=l,this.editor.addEventListener("input",l),this.editor.addEventListener("mouseup",()=>{this.emitter.emit("selectionchange",{range:this.getSelectionRange()})}),this.editor.addEventListener("keyup",()=>{this.emitter.emit("selectionchange",{range:this.getSelectionRange()})}),new MutationObserver(()=>{this.emitter.emit("change",{html:this.editor.innerHTML})}).observe(this.editor,{childList:!0,subtree:!0,characterData:!0});const a=p();for(const[u,m]of Object.entries(a))this.use(m);this.ui=new E(this)}saveState(){this.undoStack.length>=this.maxHistory&&this.undoStack.shift(),this.undoStack.push(this.editor.innerHTML),this.redoStack=[],this.emitter.emit("contentChange",{html:this.editor.innerHTML})}saveSelection(){const t=window.getSelection();t.rangeCount>0&&(this.savedRange=t.getRangeAt(0))}restoreSelection(){if(this.savedRange){const t=window.getSelection();t.removeAllRanges(),t.addRange(this.savedRange)}}saveCurrentSelection(){this.saveSelection()}restoreSavedSelection(){this.restoreSelection()}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}undo(){if(this.undoStack.length>1){const t=this.undoStack.pop();this.redoStack.push(t);const e=this.undoStack[this.undoStack.length-1];this.editor.innerHTML=e}}redo(){if(this.redoStack.length>0){const t=this.redoStack.pop();this.undoStack.push(t),this.editor.innerHTML=t}}destroy(){var t;this.inputListener&&this.editor.removeEventListener("input",this.inputListener);for(const e of this.plugins)(t=e.destroy)==null||t.call(e,this),this.emitter.emit("pluginDestroy",{pluginName:e.constructor.name});this.plugins=[]}use(t){t.init(this),this.plugins.push(t),this.emitter.emit("pluginInit",{pluginName:t.constructor.name})}getSelectionRange(){const t=window.getSelection();return t!=null&&t.rangeCount?t.getRangeAt(0):null}getParentElement(){const t=window.getSelection();if(t&&t.rangeCount>0){const e=t.getRangeAt(0);return e.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?e.commonAncestorContainer:e.commonAncestorContainer.parentElement}return null}removeParentElement(t){const e=t,n=document.createDocumentFragment();for(;e.firstChild;)n.appendChild(e.firstChild);e.replaceWith(n)}insertNode(t){this.editor.appendChild(t)}exec(t){this.saveSelection();const e=this.getSelectionRange();if(!e||e.collapsed)return;const n=e.extractContents(),o=t(n),l=document.createDocumentFragment();l.appendChild(o),e.insertNode(l),e.setStartAfter(o),e.setEndAfter(o);const s=window.getSelection();s==null||s.removeAllRanges(),s==null||s.addRange(e),this.saveState(),this.emitter.emit("execCommand",{command:t.name||"unknown"})}insertContent(t){this.saveSelection();const e=document.createElement("div");e.innerHTML=t;const n=this.getSelectionRange();if(n&&!n.collapsed){n.deleteContents();const o=document.createDocumentFragment();for(;e.firstChild;)o.appendChild(e.firstChild);n.insertNode(o),n.collapse(!1);const l=window.getSelection();l==null||l.removeAllRanges(),l==null||l.addRange(n)}else for(;e.firstChild;)this.editor.appendChild(e.firstChild);this.saveState()}toHTML(){return this.editor.innerHTML}fromHTML(t){this.editor.innerHTML=t,this.saveState()}}const C={name:"colorPicker",init(i){const t=document.createElement("label");t.style.marginLeft="8px",t.innerText="Text Color: ";const e=document.createElement("input");e.type="color",e.value="#000000",e.style.marginLeft="4px",e.oninput=()=>{const n=e.value;i.exec(o=>{const l=document.createElement("span");return l.style.color=n,l.appendChild(o),l})},t.appendChild(e),i.toolbar.appendChild(t)}},L={name:"font",init(i){const t=["Arial","Courier New","Georgia","Times New Roman","Verdana","Comic Sans MS","Impact","Lucida Sans Unicode","Tahoma","Trebuchet MS"];i.ui.addDropdown("fonts",{text:"Font",tooltip:"Font",options:t.map(e=>({label:e,value:e,onSelect:n=>{const o=n,l=i.getParentElement();if(l&&l instanceof HTMLSpanElement){l.style.fontFamily=o;return}i.exec(s=>{const a=document.createElement("span");return a.style.fontFamily=o,a.appendChild(s),a})}}))})}},k={name:"formatting",init(i){i.ui.addButton("bold",{text:"<b>B</b>",tooltip:"Bold",onAction:()=>{const e=i.getSelectionRange();if(!e||e.collapsed)return;const n=i.getParentElement();if((n==null?void 0:n.tagName)=="STRONG")return i.removeParentElement(n);i.exec(o=>{const l=document.createElement("strong");return l.appendChild(o),l})}}),i.ui.addButton("italic",{text:"<i>I</i>",tooltip:"Italic",onAction:()=>{const e=i.getSelectionRange();if(!e||e.collapsed)return;const n=i.getParentElement();if((n==null?void 0:n.tagName)=="EM")return i.removeParentElement(n);i.exec(o=>{const l=document.createElement("em");return l.appendChild(o),l})}}),i.ui.addButton("underline",{text:"<u>U</u>",tooltip:"Underline",onAction:()=>{const e=i.getSelectionRange();if(!e||e.collapsed)return;const n=i.getParentElement();if((n==null?void 0:n.tagName)=="U")return i.removeParentElement(n);i.exec(o=>{const l=document.createElement("u");return l.appendChild(o),l})}}),i.ui.addButton("image",{text:"🖼️ Image",tooltip:"Insert Image",onAction:()=>{const e=prompt("Enter image URL:");if(!e)return;const n=i.getSelectionRange();if(!n)return;const o=document.createElement("img");o.src=e,o.alt="Inserted Image",o.style.maxWidth="100%",n.insertNode(o),n.setStartAfter(o),n.setEndAfter(o);const l=window.getSelection();l&&(l.removeAllRanges(),l.addRange(n))}}),i.ui.addDropdown("format",{text:"Format",tooltip:"Text format",options:[{label:"Heading 1",value:"h1",onSelect:e=>{i.exec(n=>{const o=document.createElement(e);return o.appendChild(n),o})}},{label:"Heading 2",value:"h2",onSelect:e=>{i.exec(n=>{const o=document.createElement(e);return o.appendChild(n),o})}},{label:"Heading 3",value:"h3",onSelect:e=>{i.exec(n=>{const o=document.createElement(e);return o.appendChild(n),o})}},{label:"Heading 4",value:"h4",onSelect:e=>{i.exec(n=>{const o=document.createElement(e);return o.appendChild(n),o})}},{label:"Heading 5",value:"h5",onSelect:e=>{i.exec(n=>{const o=document.createElement(e);return o.appendChild(n),o})}},{label:"Heading 6",value:"h6",onSelect:e=>{i.exec(n=>{const o=document.createElement(e);return o.appendChild(n),o})}},{label:"Paragraph",value:"p",onSelect:e=>{i.exec(n=>{const o=document.createElement(e);return o.appendChild(n),o})}}]});const t=[{label:"Left",value:"left"},{label:"Center",value:"center"},{label:"Right",value:"right"},{label:"Justify",value:"justify"}];i.ui.addDropdown("align",{text:"Align",tooltip:"Text alignment",options:t.map(e=>({label:e.label,value:e.value,onSelect:n=>{const o=i.getSelectionRange();if(!o||o.collapsed)return;const l=i.getParentElement();if(l&&l instanceof HTMLElement)if((l==null?void 0:l.tagName)=="P"){l.style.textAlign=n;return}else i.exec(s=>{const a=document.createElement("p");return a.style.textAlign=n,a.appendChild(s),a})}}))})},destroy(i){}},x={name:"link",init(i){i.ui.addButton("myButton",{text:"Insert Link",onAction:()=>{i.saveSelection(),i.ui.showModal("insertLinkModal");const t=document.getElementById("insertLinkModal");if(!t)return;const e=t.querySelector("#modal-link-text");let n="";i.savedRange&&(n=i.savedRange.toString()),e&&(e.value=n,e.focus());const o=t.querySelector("#modal-link-url");o&&(o.value="")},tooltip:"Insert a link"}),i.ui.addModal({id:"insertLinkModal",title:"Insert Link",content:`
    <label>URL: <input type="text" id="modal-link-url" autofocus /></label>
    <br />
    <br />
    <label>Text: <input type="text" id="modal-link-text" /></label>
  `,buttons:[{text:"Cancel",onClick:t=>{t.closeModal()}},{text:"Insert",primary:!0,onClick:t=>{const n=document.getElementById("modal-link-url").value.trim();if(n){const l=document.getElementById("modal-link-text").value.trim()||n;if(i.restoreSelection(),!i.getSelectionRange())return t.closeModal();const a=i.getParentElement();if((a==null?void 0:a.tagName)==="A")return i.removeParentElement(a),t.closeModal();i.exec(u=>{const m=document.createElement("a");return m.href=n,m.target="_blank",m.rel="noopener noreferrer",u.childNodes.length===0?m.textContent=l:m.appendChild(u),m})}t.closeModal()}}]})},destroy(i){}},w={name:"undoRedo",init(i){i.ui.addButton("undo",{text:"Undo",tooltip:"Undo",onAction:()=>{i.undo()}}),i.ui.addButton("redo",{text:"Redo",tooltip:"Redo",onAction:()=>{i.redo()}}),document.addEventListener("keydown",t=>{t.ctrlKey&&t.key==="z"&&i.undo(),t.ctrlKey&&t.key==="y"&&i.redo()})}};r.Editor=y,r.EditorEventEmitter=c,r.colorPickerPlugin=C,r.fontPlugin=L,r.formattingPlugin=k,r.getRegisteredPlugin=p,r.linkPlugin=x,r.registerPlugin=v,r.undoRedoPlugin=w,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
